<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anchor Marianas Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            color: #1a4b6e;
        }

        .project-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        input[type="text"],
        input[type="url"],
        select,
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
        }

        button {
            background: #1a4b6e;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
        }

        button:hover {
            background: #0b2a4a;
        }

        .projects-list {
            margin-top: 40px;
        }

        .project-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .project-actions {
            margin-top: 10px;
        }

        .delete-btn {
            background: #dc3545;
        }

        .delete-btn:hover {
            background: #c82333;
        }

        .color-inputs {
            display: flex;
            gap: 10px;
        }

        .color-input {
            flex: 1;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Anchor Marianas Project Manager</h1>
        
        <div class="stats-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <h2>GitHub Stats</h2>
            <div id="github-stats">Loading...</div>
            <button onclick="refreshGitHubData()" style="margin-top: 10px;">Refresh GitHub Data</button>
        </div>

        <div class="project-form">
            <h2>GitHub Projects (Auto-Generated)</h2>
            <p style="color: #666; margin-bottom: 20px;">These projects are automatically fetched from your GitHub repos. Projects with homepages are marked as "Live", others as "Development". Starred repos are "Featured".</p>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff;">
                <h4 style="margin: 0 0 10px 0; color: #007bff;">How the GitHub Integration Works:</h4>
                <ul style="margin: 0; padding-left: 20px;">
                    <li><strong>Status Logic:</strong> Repos with homepage URLs → "Live", repos without → "Development"</li>
                    <li><strong>Featured Logic:</strong> Repos with stars (stargazers_count > 0) → "Featured"</li>
                    <li><strong>Auto-Generated:</strong> Emojis, colors, and tags are automatically assigned based on repo name/description</li>
                    <li><strong>Excluded:</strong> Forks and repos named 'adamtpang', 'resume', 'test', 'anchormarianas.com' are filtered out</li>
                </ul>
                <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #666;">To change how a project appears, update your GitHub repo's homepage URL, description, or star it!</p>
            </div>
        </div>

        <div class="projects-list" id="projectsList">
            <!-- Projects will be loaded here -->
        </div>
    </div>

    <script>
        let projects = [];
        
        async function loadProjects() {
            try {
                // Load from GitHub API instead of projects.json
                const repoRes = await fetch('https://api.github.com/users/adamtpang/repos?sort=pushed&per_page=100');
                if (!repoRes.ok) throw new Error(`GitHub API failed: ${repoRes.status}`);

                const allRepos = await repoRes.json();
                const excludeRepos = ['adamtpang', 'resume', 'test'];
                const filteredRepos = allRepos.filter(repo => 
                    !repo.fork && 
                    !excludeRepos.includes(repo.name) &&
                    repo.name !== 'anchormarianas.com'
                );

                // Transform GitHub repos to our project format
                projects = filteredRepos.map((repo, index) => {
                    return {
                        name: repo.name,
                        description: repo.description || 'No description provided',
                        homepage: repo.homepage || '',
                        status: repo.homepage ? 'live' : 'development',
                        featured: repo.stargazers_count > 0,
                        emoji: getEmojiForProject(repo.name, repo.description),
                        colors: generateGradientColors(index),
                        tags: getTagsFromRepo(repo),
                        stars: repo.stargazers_count,
                        github_url: repo.html_url,
                        created_at: repo.created_at,
                        updated_at: repo.updated_at,
                        language: repo.language
                    };
                });

                // Sort by update date (most recent first)
                projects.sort((a, b) => new Date(b.updated_at) - new Date(a.updated_at));
                
                displayProjects(projects);
                updateGitHubStats();
                
            } catch (error) {
                console.error('Error loading projects:', error);
                projects = [];
                displayProjects(projects);
                document.getElementById('github-stats').innerHTML = 'Error loading GitHub data';
            }
        }
        
        function getEmojiForProject(name, description) {
            const text = (name + ' ' + (description || '')).toLowerCase();
            
            if (text.includes('website') || text.includes('site') || text.includes('web')) return '🌐';
            if (text.includes('portfolio') || text.includes('resume')) return '📄';
            if (text.includes('game') || text.includes('play')) return '🎮';
            if (text.includes('api') || text.includes('server')) return '⚙️';
            if (text.includes('bot') || text.includes('automation')) return '🤖';
            if (text.includes('ai') || text.includes('machine learning')) return '🧠';
            if (text.includes('mobile') || text.includes('app')) return '📱';
            if (text.includes('tool') || text.includes('utility')) return '🔧';
            if (text.includes('dashboard') || text.includes('admin')) return '📊';
            
            return '💻';
        }
        
        function generateGradientColors(index) {
            const gradients = [
                { from: '#667eea', to: '#764ba2' },
                { from: '#f093fb', to: '#f5576c' },
                { from: '#4facfe', to: '#00f2fe' },
                { from: '#43e97b', to: '#38f9d7' },
                { from: '#fa709a', to: '#fee140' },
                { from: '#a8edea', to: '#fed6e3' }
            ];
            return gradients[index % gradients.length];
        }
        
        function getTagsFromRepo(repo) {
            const tags = [];
            if (repo.language) tags.push(repo.language);
            
            const text = (repo.name + ' ' + (repo.description || '')).toLowerCase();
            if (text.includes('react')) tags.push('React');
            if (text.includes('vue')) tags.push('Vue.js');
            if (text.includes('node')) tags.push('Node.js');
            if (text.includes('api')) tags.push('API');
            
            return [...new Set(tags)].slice(0, 3);
        }
        
        function updateGitHubStats() {
            const totalRepos = projects.length;
            const liveProjects = projects.filter(p => p.status === 'live').length;
            const featuredProjects = projects.filter(p => p.featured).length;
            const totalStars = projects.reduce((sum, p) => sum + p.stars, 0);
            const languages = [...new Set(projects.map(p => p.language).filter(Boolean))];
            
            document.getElementById('github-stats').innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 15px 0;">
                    <div style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                        <strong>${totalRepos}</strong><br>
                        <small>Total Repos</small>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #e8f5e8; border-radius: 8px;">
                        <strong>${liveProjects}</strong><br>
                        <small>Live Projects</small>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #fff3cd; border-radius: 8px;">
                        <strong>${featuredProjects}</strong><br>
                        <small>Featured (Starred)</small>
                    </div>
                    <div style="text-align: center; padding: 10px; background: #f8d7da; border-radius: 8px;">
                        <strong>${totalStars}</strong><br>
                        <small>Total Stars</small>
                    </div>
                </div>
                <p><strong>Languages:</strong> ${languages.join(', ') || 'None detected'}</p>
                <p><small>Last updated: ${new Date().toLocaleString()}</small></p>
            `;
        }
        
        function refreshGitHubData() {
            document.getElementById('github-stats').innerHTML = 'Refreshing...';
            loadProjects();
        }

        function displayProjects(projectList) {
            const projectsList = document.getElementById('projectsList');
            projectsList.innerHTML = '';

            if (projectList.length === 0) {
                projectsList.innerHTML = '<p>No GitHub repositories found.</p>';
                return;
            }

            projectList.forEach(project => {
                const projectCard = document.createElement('div');
                projectCard.className = 'project-card';
                
                const statusColor = project.status === 'live' ? '#28a745' : '#ffc107';
                const statusText = project.status === 'live' ? 'Live (has homepage)' : 'Development (no homepage)';
                
                projectCard.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                        <h3>${project.emoji} ${project.name} ${project.featured ? '⭐' : ''}</h3>
                        <span style="background: ${statusColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem;">
                            ${statusText}
                        </span>
                    </div>
                    
                    <p style="margin-bottom: 10px;"><strong>Description:</strong> ${project.description}</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; font-size: 0.9rem;">
                        <div><strong>Language:</strong> ${project.language || 'Not detected'}</div>
                        <div><strong>Stars:</strong> ${project.stars}</div>
                        <div><strong>Created:</strong> ${new Date(project.created_at).toLocaleDateString()}</div>
                        <div><strong>Updated:</strong> ${new Date(project.updated_at).toLocaleDateString()}</div>
                    </div>
                    
                    <div style="margin-bottom: 10px;">
                        <strong>Links:</strong>
                        <a href="${project.github_url}" target="_blank" style="margin-left: 10px;">GitHub</a>
                        ${project.homepage ? `<a href="${project.homepage}" target="_blank" style="margin-left: 10px;">Live Site</a>` : ''}
                    </div>
                    
                    ${project.tags && project.tags.length > 0 ? `
                        <div style="margin-bottom: 10px;">
                            <strong>Tags:</strong> ${project.tags.map(tag => `<span style="background: #e9ecef; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-left: 5px;">${tag}</span>`).join('')}
                        </div>
                    ` : ''}
                    
                    <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid #eee; font-size: 0.85em; color: #666;">
                        This project will appear as <strong>${project.status}</strong> on the main site.
                        ${project.featured ? ' It will be marked as <strong>featured</strong> because it has stars.' : ''}
                    </div>
                `;
                projectsList.appendChild(projectCard);
            });
        }

        // Projects are now managed through GitHub, no manual editing needed

        // Initialize
        loadProjects();
    </script>
</body>

</html>